<html>
<head>
  <title>Lexical Change Viewer</title>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <script src="main.js" type="text/javascript"></script>
  <link rel="stylesheet" href="http://netdna.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css">
  <style>
.leaf-wrap {
	border: 1px dashed Crimson;
	display: inline-block;
	margin-left: 47px;
	position: relative;
	margin-top: 2px;
	margin-bottom: 2px;
	border-radius: 25px;
	padding: 5px;
	background-color: lightblue;
}
.leaf-element {
	display: table-row;
}
.leaf-content {
	display: table-cell;
}
.leaf-name {
	display: table-cell;
	min-width: 150px;
	border: 1px dotted lightgray;

}
.node-wrap {
	border: 1px dashed gray;
	display: inline-block;
	margin-left: 47px;
	//max-width: 150px;
	position: relative;
	border-radius: 25px;
	padding: 5px;
}
.node-content {
	display: table-cell;
}
.node-name {
	display: table-cell;
	cursor: pointer;
	margin-left: 10px;
	padding-left: 5px;
	width: 100px;
	border: 1px dotted lightgray;
}
.node-element {
	display: block;
	margin-bottom: 5px;
	margin-top: 5px;
}
.loss {
	border: 1px solid lightgray;
}

.loss:after {
	content: " Ø";
	margin-left: 5px;
}

.colors {
	display: table-cell;
	margin: 10px;
	padding: 10px;
	border: 2px solid lightgray;
	color: white;
	font-weight: bold;
}

li.node:before {
	content: '';
	width: 50px;
	height: 30px;
	position: relative;
	display: table-cell;
	bottom: 0;
	top: 0;
	left: -5px;
	border-bottom: 5px solid green;
	border-left: 5px solid green;
	z-index: 1;
}
li.node {
	position: relative;
	margin: 0;
	bottom: 0;
	top: 0;
	left: 5em;
	border-left: 5px solid green;
	list-style:none;
	display: block;
}

li.node:last-child {
	margin: 0;
	position: relative;
	bottom: 0;
	top: 0;
	left: 5em;
	border-left: 5px solid white;
	list-style: none;
}


  </style>
</head>
<body>
  <h1>Lexical Change Viewer (Powered by LingPy)</h1>
  <button style="background-color:Crimson" onclick="toggleWords()">TOGGLE</button>
  <select id="selector"> 
  <option value="ant">ant</option><option value="arrow">arrow</option><option value="ashes">ashes</option><option value="bamboo">bamboo</option><option value="banana">banana</option><option value="bear">bear</option><option value="bird">bird</option><option value="bitter">bitter</option><option value="black">black</option><option value="blood">blood</option><option value="boat">boat</option><option value="bone">bone</option><option value="bow, crossbow">bow, crossbow</option><option value="brain">brain</option><option value="branch">branch</option><option value="breast">breast</option><option value="cloud">cloud</option><option value="cold">cold</option><option value="dog">dog</option><option value="dry">dry</option><option value="ear">ear</option><option value="earth (soil)">earth (soil)</option><option value="egg">egg</option><option value="eye">eye</option><option value="finger">finger</option><option value="fire">fire</option><option value="fish">fish</option><option value="five">five</option><option value="flower">flower</option><option value="foot">foot</option><option value="four">four</option><option value="frog">frog</option><option value="fruit">fruit</option><option value="full">full</option><option value="grandchild">grandchild</option><option value="grass">grass</option><option value="green">green</option><option value="hair (head)">hair (head)</option><option value="hand">hand</option><option value="head">head</option><option value="heart">heart</option><option value="heavy">heavy</option><option value="horn">horn</option><option value="house">house</option><option value="I, me">I, me</option><option value="leaf">leaf</option><option value="leech (land)">leech (land)</option><option value="left (side)">left (side)</option><option value="light (weight)">light (weight)</option><option value="liver">liver</option><option value="long">long</option><option value="louse">louse</option><option value="man (male human)">man (male human)</option><option value="many">many</option><option value="medicine">medicine</option><option value="moon">moon</option><option value="mortar">mortar</option><option value="mountain">mountain</option><option value="mouth">mouth</option><option value="name">name</option><option value="navel">navel</option><option value="near">near</option><option value="neck">neck</option><option value="new">new</option><option value="night">night</option><option value="nose">nose</option><option value="old">old</option><option value="one">one</option><option value="palm (of hand)">palm (of hand)</option><option value="penis">penis</option><option value="person">person</option><option value="pig">pig</option><option value="rain">rain</option><option value="red">red</option><option value="rice (cooked)">rice (cooked)</option><option value="rice (unhusked)">rice (unhusked)</option><option value="right (side)">right (side)</option><option value="river">river</option><option value="root">root</option><option value="round">round</option><option value="salt">salt</option><option value="sand">sand</option><option value="seed">seed</option><option value="seven">seven</option><option value="sharp (edged)">sharp (edged)</option><option value="six">six</option><option value="sky">sky</option><option value="smoke">smoke</option><option value="snake">snake</option><option value="soft (touch)">soft (touch)</option><option value="sour">sour</option><option value="star">star</option><option value="stick of wood">stick of wood</option><option value="stone">stone</option><option value="sweet">sweet</option><option value="tail">tail</option><option value="thick (object)">thick (object)</option><option value="thin (object)">thin (object)</option><option value="thorn">thorn</option><option value="three">three</option><option value="to be born">to be born</option><option value="to bite">to bite</option><option value="to blow">to blow</option><option value="to burn (tr.)">to burn (tr.)</option><option value="to cough">to cough</option><option value="to descend">to descend</option><option value="to die">to die</option><option value="to dig">to dig</option><option value="to dream">to dream</option><option value="to drink (water)">to drink (water)</option><option value="to eat">to eat</option><option value="to fall">to fall</option><option value="to fly">to fly</option><option value="to forget">to forget</option><option value="to give">to give</option><option value="to hear">to hear</option><option value="to hunt">to hunt</option><option value="to kick">to kick</option><option value="to kill">to kill</option><option value="to know">to know</option><option value="to laugh">to laugh</option><option value="to lick">to lick</option><option value="to see">to see</option><option value="to sew">to sew</option><option value="to shoot">to shoot</option><option value="to sit">to sit</option><option value="to smell (receive odor)">to smell (receive odor)</option><option value="to spit">to spit</option><option value="to stand">to stand</option><option value="to steal">to steal</option><option value="to vomit">to vomit</option><option value="to wash (hands, things)">to wash (hands, things)</option><option value="to weave">to weave</option><option value="tongue">tongue</option><option value="tooth">tooth</option><option value="tree">tree</option><option value="two">two</option><option value="water">water</option><option value="white">white</option><option value="wing">wing</option><option value="woman">woman</option><option value="yellow">yellow</option><option value="you (pl.)">you (pl.)</option><option value="you (sing.)">you (sing.)</option>
  </select>
  <button onclick="loadConcept()">SUBMIT</button>
  <h2 id="header"></h2>
  <div id="colors"></div>


  <div id="display"></div>

  <script>
var DATA = {};
DATA['settings'] = 'words';

function toggleWords() {
  if (DATA['settings'] == 'words') {DATA['settings'] = '';} else
    {DATA['settings'] = 'words'; console.log(DATA['settings']);}
}

function loadConcept() {

  var concept = '';
  var selection = document.getElementById('selector');
  for (var i=0,sel; sel=selector.options[i]; i++) {
    if (sel.selected) {
      concept = sel.value;
      break;
    }
  }
  
  $.ajax({
   dataType: "json",
   async: false,
   url: 'json/'+concept+'.json',
   success: function(data){console.log('sucess');
     for (key in data) {
       DATA[key] = data[key];
     }}
  });
  
  
  var display = document.getElementById('display');
  
  var queue = DATA['order'];
  var txt = '<ul><li id="E_root" style="list-style:none">{root}</li></ul>';
  
  /* iterate over the queue */
  for (var i=0,name; name=queue[i]; i++) {
    var children = DATA[name]['children'];
    
    if (children.length >= 1) {
      if (DATA[name]['consensus'].length > 0) {
	var rep_string = '';
	rep_string += '<div class="node-wrap" onclick="modifyEdge(\''+name+'\');">';

      	for (var j=0,cns; cns=DATA[name]['consensus'][j]; j++) {
	  if (DATA[name]['retention'][j] == '1') {
	    var symbol = '→ ';
	  }
	  else {
	    var symbol = '* ';
	  }
      	  rep_string += '<div oncontextmenu="showAlignment(event,\''+name+'\','+j+')" class="node-element"><div class="node-name"'
      	    +'>'
      	    +symbol + ' '+DATA[name]['paps'][j]+' '
      	    +'</div><div class="node-content" style="border: 5px solid '+DATA[name]['colors'][j]+'">';
    
	  if (DATA['settings'] == 'words') {
	    rep_string += plotWord(cns.join(' '));
	  }
	  else {
	    rep_string += '';
	  }
	  rep_string += ''
      	    +'</div></div>';
      	}
	rep_string += '</div>';
      }
      else {
	var rep_string = '';
	rep_string += '<div onclick="modifyEdge(\''+name+'\');" class="node-wrap">';
	rep_string += '<div title="'+name+'" class="node-name loss"'
	  + '>'
	  + name
	  + '</div><div class="node-content">';
	rep_string += ''
	  + '</div>'
	  + '</div>';
      }
    }
    else {
      if (DATA[name]['consensus'].length > 0) {
	var rep_string = '';
      	rep_string += '<div class="leaf-wrap" name="'+name+'">';
      	for (var j=0,cns; cns=DATA[name]['consensus'][j]; j++) {
	  if (DATA[name]['retention'][j] == '1') {
	    var symbol = '→ ';
	  }
	  else {
	    var symbol = '* ';
	  }

      	  rep_string += '<div class="leaf-element"><div class="leaf-name">'
      	    +symbol + ' '+name+' ' + DATA[name]['paps'][j] + ' '
      	    +'</div><div class="leaf-content" style="color:white;border:5px solid '+DATA[name]['colors'][j]+'">';
	  if (DATA['settings'] == 'words') {
	    rep_string += plotWord(cns.join(' '));
	  }
	  else {
	    rep_string += '';
	  }
	  rep_string += ''
      	    +'</div></div>';
      	}
      	rep_string += '</div>';
      }
      else {
	var rep_string = '';
	rep_string += '<div class="leaf-wrap" style="border: 2px dotted black;">';
	rep_string += '' 
	  + '<div class="leaf-name loss">'
	  + name 
	  + '</div><div class="leaf-content">';
	rep_string += ' '
	  + '</div>'
	  + '</div>';
      }
    }
    rep_string += '<ul>';
    for (var j=0,child; child = children[j]; j++) {
      rep_string += '<li class="node" id="E_'+child+'">{'+child+'}</li>';
    }
    rep_string += '</ul>';
    txt = txt.replace('{'+name+'}',rep_string);

  }
  
  /* add concept to header line */
  document.getElementById('header').innerHTML = "Lexical Evolution of &quot;"+concept+'&quot;';
  
  /* add colors */
  var col = document.getElementById('colors');
  var tmp = '';
  for (key in DATA['colors']) {
    tmp += '<div class="colors" style="background-color:'+DATA['colors'][key]+'">'
      + key
      + '</div>';
  }
  col.innerHTML = tmp;
  
  /* submit the display */
  display.innerHTML = txt; 
  
}

function modifyEdge(name) {
  var edge = document.getElementById('E_'+name);
  for (var i=1,child; child=edge.childNodes[i]; i++) {
    if (child.style.display == 'none') {
      child.style.display = 'block';
    }
    else {
      child.style.display = 'none';
    }
  }
}

function fakeAlert(text){
  var falert = document.createElement('div');
  falert.id = 'fake';
  var text = '<div class="message"><p>' + text + '</p>';
  text += '<div class="btn btn-primary okbutton" onclick="' + "$('#fake').remove(); document.onkeydown = function(event){basickeydown(event)};" + '")> OK </div></div>';
  falert.className = 'fake_alert';

  document.body.appendChild(falert);
  falert.innerHTML = text;
  document.onkeydown = function(event){$('#fake').remove(); document.onkeydown = function(event){basickeydown(event);};};
}

function showAlignment(event,name,idx) {
  event.preventDefault();
  var alms = DATA[name]['alignments'][idx];
  var txt = '<table>';
  for (var i=0,alm; alm=alms[i]; i++) {
    txt += '<th>'+DATA[name]['taxa'][idx][i]+'</th>';
    txt += '<td>'+plotWord(alm.join(' '),'td')+'</td></tr>';
  }
  txt += '</table>';
  fakeAlert(txt);
}

function prettyfy() {
// Select the main list and add the class "hasSubmenu" in each LI that contains an UL
$('ul').each(function(){
  $this = $(this);
  $this.find("li").has("div ul").addClass("hasSubmenu");
});

// Find the last li in each level
$('li:last-child').each(function(){
  console.log('last child');
  $this = $(this);
  // Check if LI has children
  if ($this.children('ul').length === 0){
    // Add border-left in every UL where the last LI has not children
    $this.closest('ul').css("border-left", "5px solid Crimson");
  } else {
    // Add border in child LI, except in the last one
    $this.closest('ul').children("li").not(":last").css("border-left","5px solid Green");
    // Add the class "addBorderBefore" to create the pseudo-element :defore in the last li
    $this.closest('ul').children("li").last().children("a").addClass("addBorderBefore");
    // Add margin in the first level of the list
    $this.closest('ul').css("margin-top","20px");
    // Add margin in other levels of the list
    $this.closest('ul').find("li").children("ul").css("margin-top","20px");
  };
});
// Add bold in li and levels above
$('ul li').each(function(){
  $this = $(this);
  $this.mouseenter(function(){
    $( this ).children("a").css({"font-weight":"bold","color":"#336b9b"});
  });
  $this.mouseleave(function(){
    $( this ).children("a").css({"font-weight":"normal","color":"#428bca"});
  });
});
// Add button to expand and condense - Using FontAwesome
$('ul li.hasSubmenu').each(function(){
  $this = $(this);
  $this.prepend("<a href='#'><i class='fa fa-minus-circle'></i><i style='display:none;' class='fa fa-plus-circle'></i></a>");
  $this.children("a").not(":last").removeClass().addClass("toogle");
});
// Actions to expand and consense
$('ul li.hasSubmenu a.toogle').click(function(){
  $this = $(this);
  $this.closest("li").children("ul").toggle("slow");
  $this.children("i").toggle();
  return false;
});
}

  </script>
</body>
</html>
